# List of changes:
#	- Emperor Takes Power event (meiji.1):
#		-- Updated historical emperor traits:
#			--- Ninko Yamato
#           	---- Romantic trait added
#       	--- Komei Yamato
#           	---- Reserved trait removed
#           	---- Wrathful trait added
#           	---- Brave trait added
#           	---- Bigoted trait added
#       	--- Meiji Yamato
#           	---- Reserved trait added
#       	--- Taisho Yamato
#           	---- Sickly trait added
#           	---- Psychological Affliction trait added
#           	---- Direct trait added
#       	--- Showa Yamato (Hirohito)
#           	---- Ambitious trait added
#           	---- Persistent trait added
#           	---- Reckless trait added
#		-- Changed historical emperor spawns:
#       	--- Komei Yamato
#       		---- Spawn range changed from 1852-1877 to 1852-1866
#       	--- Meiji Yamato
#       		---- Spawn range changed from 1878-1912 to 1867-1912
#		-- Both Options:
#			--- Updated conditions to bypass je_meiji_economy journal entry to be >= 70% states with appropriate conditions from > 70%
#	- Fall of the Samurai event (meiji.3):
#		-- Both Options:
#			--- Samurai IG also get Jingoist Ideology added to them

# Emperor takes power
meiji.1 = {
	type = country_event
	placement = root
	title = meiji.1.t
	desc = meiji.1.d
	flavor = meiji.1.f

	duration = 3

	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	gui_window = event_window_1char_tabloid

	left_icon = scope:meiji_ruler

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	trigger = {
		# triggered by meiji restoration JE
	}

	immediate = {
		set_variable = {
			name = meiji_var
			value = 0
		}
		ig:ig_landowners = {
			save_scope_as = shogunate_ig
			leader = {
				save_scope_as = shogunate_ig_leader
			}
		}
		if = {
			limit = {
				year < 1852
			}
			create_character = {
				# Emperor Ninko
				first_name = "Ninko"
				last_name = "Yamato"
				historical = yes
				ruler = yes
				birth_date = 1800.1.1
				dna = dna_ninko
				interest_group = ig_landowners # beholden to the Shogun
				ideology = ideology_traditionalist
				traits = {
					reserved # not very active in affairs of state
					romantic # established a special school for nobles
				}
			}
			create_character = {
				first_name = "Komei"
				last_name = Yamato
				historical = yes
				heir = yes
				birth_date = 1831.1.1
				dna = dna_emperor_komei
				interest_group = ig_armed_forces
				traits = {
					# Generally very angry at shogunate opening itself up to foreigners, tried to issue Decree to Expel Barbarians
					brave
					wrathful
					bigoted
				}
			}
		}
		else_if = {
			limit = {
				year >= 1852
				year < 1867
			}
			create_character = {
				first_name = "Komei"
				last_name = "Yamato"
				historical = yes
				ruler = yes
				birth_date = 1831.1.1
				dna = dna_emperor_komei
				interest_group = ig_armed_forces
				traits = {
					# Generally very angry at shogunate opening itself up to foreigners, tried to issue Decree to Expel Barbarians
					brave
					wrathful
					bigoted
				}
			}
			create_character = {
				first_name = "Meiji"
				last_name = "Yamato"
				historical = yes
				heir = yes
				birth_date = 1852.1.1
				dna = dna_emperor_meiji
				interest_group = ig_industrialists
				traits = {
					# Oddly unknown figure with wildly varying accounts of his personality. Left very few records of his personal thoughts behind.
					innovative
					charismatic
					reserved
				}
			}
		}
		else_if = {
			limit = {
				year >= 1867
				year < 1912
			}
			create_character = {
				first_name = "Meiji"
				last_name = "Yamato"
				historical = yes
				ruler = yes
				birth_date = 1852.1.1
				dna = dna_emperor_meiji
				interest_group = ig_industrialists
				traits = {
					# Oddly unknown figure with wildly varying accounts of his personality. Left very few records of his personal thoughts behind.
					innovative
					charismatic
					reserved
				}
			}
			create_character = {
				first_name = "Taisho"
				last_name = "Yamato"
				historical = yes
				heir = yes
				birth_date = 1879.1.1
				interest_group = ig_industrialists
				traits = {
					# Regularly ill throughout his entire life and developmentally challenged as a result of having contracted cerebral meningitis when he was three weeks old
					sickly
					psychological_affliction
					direct
				}
			}
		}
		else_if = {
			limit = {
				year >= 1912
				year < 1928
			}
			create_character = {
				first_name = "Taisho"
				last_name = "Yamato"
				historical = yes
				ruler = yes
				birth_date = 1879.1.1
				interest_group = ig_industrialists
				traits = {
					# Regularly ill throughout his entire life and developmentally challenged as a result of having contracted cerebral meningitis when he was three weeks old
					sickly
					psychological_affliction
					direct
				}
			}
			create_character = {
				first_name = "Showa" # Hirohito
				last_name = "Yamato"
				historical = yes
				heir = yes
				birth_date = 1901.1.1
				interest_group = ig_armed_forces
				traits = {
					# Was very politically involved from a young age, but also all over the place ideologically and bad at understanding just how much power he wielded
					ambitious
					persistent
					reckless
				}
			}
		}
		else_if = {
			limit = {
				year >= 1928
				year < 1989
			}
			create_character = {
				first_name = "Showa" # Hirohito
				last_name = "Yamato"
				historical = yes
				heir = yes
				birth_date = 1901.1.1
				interest_group = ig_armed_forces
				traits = {
					# Was very politically involved from a young age, but also all over the place ideologically and bad at understanding just how much power he wielded
					ambitious
					persistent
					reckless
				}
			}
		}
		ruler = {
			save_scope_as = meiji_ruler
		}
		add_journal_entry = {
			type = je_meiji_main
		}
	}

	option = { # favour the industrialists
		name = meiji.1.a
		default_option = yes
		ig:ig_industrialists = {
			add_modifier = {
				name = meiji_favored_ig
				months = normal_modifier_time
			}
		}
		set_capital = STATE_KANTO
		custom_tooltip = shogunate_rename.tt
		hidden_effect = {
			scope:shogunate_ig = {
				set_interest_group_name = ig_landowners
			}
		}
		scope:shogunate_ig_leader = { # honorable sudoku
			kill_character = yes
		}
		if = {
			limit = {
				in_default = no
				any_scope_state = {
					filter = {
						is_incorporated = yes
					}
					any_scope_building = {
						is_building_type = building_urban_center
						level >= 5
					}
					has_building = building_railway
					percent >= 0.7
				}
			}
			change_variable = {
				name = meiji_var
				add = 1
			}
		}
		else = {
			add_journal_entry = {
				type = je_meiji_economy
			}
		}
		if = {
			limit = {
				NOT = { has_law = law_type:law_serfdom }
				ig:ig_armed_forces = {
					is_powerful = no
					is_in_government = no
				}
				has_technology_researched = napoleonic_warfare
				NOT = {
					any_scope_building = {
						is_building_type = building_barracks
						OR = {
							has_active_production_method = pm_no_organization
							# has_active_production_method = pm_no_artillery
							# has_active_production_method = pm_cannon_artillery
						}
					}
				}
			}
			change_variable = {
				name = meiji_var
				add = 1
			}
			trigger_event = {
				id = meiji.3
			}
		}
		else = {
			add_journal_entry = {
				type = je_meiji_army
			}
		}
		if = {
			limit = {
				NOT = { is_country_type = unrecognized }
				NOT = { has_law = law_type:law_isolationism }
			}
			change_variable = {
				name = meiji_var
				add = 1
			}
		}
		else = {
			add_journal_entry = {
				type = je_meiji_diplomacy
			}
		}
	}
	option = { # favour the intellectuals
		name = meiji.1.b
		ig:ig_intelligentsia = {
			add_modifier = {
				name = meiji_favored_ig
				months = normal_modifier_time
			}
		}
		set_capital = STATE_KANTO
		custom_tooltip = shogunate_rename.tt
		hidden_effect = {
			scope:shogunate_ig = {
				set_interest_group_name = ig_landowners
			}
		}
		scope:shogunate_ig_leader = {
			kill_character = yes
		}
		if = {
			limit = {
				in_default = no
				any_scope_state = {
					filter = {
						is_incorporated = yes
					}
					any_scope_building = {
						is_building_type = building_urban_center
						level >= 5
					}
					has_building = building_railway
					percent >= 0.7
				}
			}
			change_variable = {
				name = meiji_var
				add = 1
			}
		}
		else = {
			add_journal_entry = {
				type = je_meiji_economy
			}
		}
		if = {
			limit = {
				NOT = { has_law = law_type:law_serfdom }
				ig:ig_armed_forces = {
					is_powerful = no
					is_in_government = no
				}
				has_technology_researched = napoleonic_warfare
				NOT = {
					any_scope_building = {
						is_building_type = building_barracks
						OR = {
							has_active_production_method = pm_no_organization
							# has_active_production_method = pm_no_artillery
							# has_active_production_method = pm_cannon_artillery
						}
					}
				}
			}
			change_variable = {
				name = meiji_var
				add = 1
			}
			trigger_event = {
				id = meiji.3
			}
		}
		else = {
			add_journal_entry = {
				type = je_meiji_army
			}
		}
		if = {
			limit = {
				NOT = { is_country_type = unrecognized }
				NOT = { has_law = law_type:law_isolationism }
			}
			change_variable = {
				name = meiji_var
				add = 1
			}
		}
		else = {
			add_journal_entry = {
				type = je_meiji_diplomacy
			}
		}
	}
}

# Fall of the Samurai
meiji.3 = {
	type = country_event
	placement = root
	title = meiji.3.t
	desc = meiji.3.d
	flavor = meiji.3.f

	duration = 3

	icon = "gfx/interface/icons/event_icons/event_military.dds"
	event_image = {
		video = "asia_westerners_arriving"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	trigger = {
		# triggered by JE
	}

	immediate = {
		set_global_variable = fall_of_the_samurai_global_var
		ig:ig_armed_forces = {
			save_scope_as = samurai_ig
			leader = {
				save_scope_as = samurai_ig_leader
			}
		}
	}

	option = { # give former samurai officer positions in the new army
		name = meiji.3.a
		default_option = yes
		custom_tooltip = samurai_rename.tt
		hidden_effect = {
			scope:samurai_ig = {
				set_interest_group_name = ig_armed_forces
			}
		}
		scope:samurai_ig = {
			remove_ideology = ideology_bakufu
			add_ideology = ideology_jingoist
		}
		# reduce mil tech spread
		add_modifier = {
			name = samurai_officers
			months = normal_modifier_time
		}
	}
	option = { # expel the samurai from the army
		name = meiji.3.b
		custom_tooltip = samurai_rename.tt
		hidden_effect = {
			scope:samurai_ig = {
				set_interest_group_name = ig_armed_forces
			}
		}
		scope:samurai_ig = {
			remove_ideology = ideology_bakufu
			add_ideology = ideology_jingoist
		}
		scope:samurai_ig_leader = { # honorable sudoku
			kill_character = yes
		}
		add_radicals = {
			pop_type = officers
			culture = cu:japanese
			value = 0.8
		}
		add_radicals = {
			pop_type = soldiers
			culture = cu:japanese
			value = 0.5
		}
	}
}
